### 双向数据绑定的原理

Vue.js是采用**数据劫持**结合**发布者-订阅者模式**的方式，通过0bject.defineProperty()来劫持各个属性的setter ,getter,在数据变动时发布消息给订阅者，触发相应的监听回调。

**什么是数据劫持？**

数据劫持，指的是在访问或者修改对象的某个属性时，通过一段代码拦截这个行为，进行额外的操作或者修改返回结果。

**什么是发布者-订阅者模式？**

发布—订阅模式又叫观察者模式，它定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知。

1.需要observe的数据对象进行递归遍历，包括子属性对象的属性，都加上setter和getter这样的话，给这个对象的某个值赋值，就会触发setter, 那么就能监听到了数据变化

2.compile解析模板指令,将模板中的变替换成数据，然后初始化渲染页面视图,并将每个指令对应的节点绑定更新函数，添加监听数据的订阅者，一旦数据有变动，收到通知，更新视图

3.Watcher订阅者是Observer和Compile之间通信的桥梁,主要做的事情是:①在自身实例化时往属性订阅器(dep)里面添加自己②自身必须有一个update0方法 ③待属性变动dep.notice0通知时,能调用自身的update0方法，并触发Compile中绑定的回调,则功成身退。

4.MVVM作为数据绑定的入口,整合Observer、 Compile和Watcher三者,通过Observer来监听自己的model数据变化,通过Compile来解析编译模板指令，最终利用Watcher搭起Observer和Compile之 间的通信桥梁,达到数据变化->视图更新;视图交互变化(input) ->数据model变更的双向绑定效果。

![img](https://cdn.nlark.com/yuque/0/2021/png/1500604/1618656573096-ebdc520c-5d60-4d12-ad04-5df4ebbb5fe7.png)